# å®ç°è·¯çº¿å›¾ - adversarial_trainer.py å’Œ train.py

## æ–‡æ¡£ç´¢å¼•

1. **PLAN_adversarial_trainer.md** - å¯¹æŠ—è®­ç»ƒå™¨è¯¦ç»†è®¾è®¡ï¼ˆç¬¬1éƒ¨åˆ†ï¼‰
2. **PLAN_adversarial_trainer_part2.md** - å¯¹æŠ—è®­ç»ƒå™¨è¯¦ç»†è®¾è®¡ï¼ˆç¬¬2éƒ¨åˆ†ï¼‰
3. **PLAN_train.md** - ä¸»è®­ç»ƒè„šæœ¬è¯¦ç»†è®¾è®¡ï¼ˆç¬¬1éƒ¨åˆ†ï¼‰
4. **PLAN_train_part2.md** - ä¸»è®­ç»ƒè„šæœ¬è¯¦ç»†è®¾è®¡ï¼ˆç¬¬2éƒ¨åˆ†ï¼‰
5. **PLAN_train_part3.md** - ä¸»è®­ç»ƒè„šæœ¬è¯¦ç»†è®¾è®¡ï¼ˆç¬¬3éƒ¨åˆ†ï¼‰

---

## ä¸€ã€adversarial_trainer.py æ¦‚è§ˆ

### æ ¸å¿ƒèŒè´£
å¯¹æŠ—è®­ç»ƒå¼•æ“ - è´Ÿè´£ç§ç¾¤å†…ä¸ªä½“çš„å¯¹æˆ˜é…å¯¹ã€å¹¶è¡Œæ‰§è¡Œã€ç»Ÿè®¡æ”¶é›†å’Œé€‚åº”åº¦æ›´æ–°ã€‚

### ä¸»è¦ç»„ä»¶

#### 1. é…å¯¹ç­–ç•¥æ¨¡å—
- `MatchupStrategy` (æŠ½è±¡åŸºç±»)
- `RoundRobinStrategy` (å¾ªç¯èµ›)
- `TournamentStrategy` (é”¦æ ‡èµ›)
- `AdaptiveMatchupStrategy` (è‡ªé€‚åº”ç­–ç•¥)

#### 2. å¯¹æˆ˜æ‰§è¡Œæ¨¡å—
- `GameResult` (æ•°æ®ç±»)
- `run_single_game()` (å‡½æ•°)

#### 3. å¹¶è¡Œæ‰§è¡Œæ¨¡å—
- `ParallelGameExecutor` (ç±»)

#### 4. é€‚åº”åº¦æ›´æ–°æ¨¡å—
- `update_fitness_from_results()` (å‡½æ•°)

#### 5. ä¸»è®­ç»ƒæ¥å£
- `AdversarialTrainer` (ç»Ÿä¸€ç®¡ç†ç±»)

### ä»£ç é‡ä¼°ç®—
çº¦ 610 è¡Œï¼ˆåŒ…å«æ³¨é‡Šå’Œæµ‹è¯•ï¼‰

---

## äºŒã€train.py æ¦‚è§ˆ

### æ ¸å¿ƒèŒè´£
ä¸»è®­ç»ƒè„šæœ¬ - æ•´åˆæ‰€æœ‰æ¨¡å—ï¼Œå®ç°å®Œæ•´çš„è¿›åŒ–è®­ç»ƒæµç¨‹ã€‚

### ä¸»è¦ç»„ä»¶

#### 1. é…ç½®ç®¡ç†
- `TrainingConfig` (æ•°æ®ç±»)
- `load_config()` / `save_config()` (å‡½æ•°)

#### 2. æ£€æŸ¥ç‚¹ç®¡ç†
- `CheckpointManager` (ç±»)
  - ä¿å­˜/åŠ è½½æ£€æŸ¥ç‚¹
  - ç®¡ç†æœ€ä½³æ¨¡å‹
  - è‡ªåŠ¨æ¸…ç†æ—§æ–‡ä»¶

#### 3. æ—¥å¿—ç³»ç»Ÿ
- `TrainingLogger` (ç±»)
  - CSVæ—¥å¿—
  - æ–‡æœ¬æ—¥å¿—
  - æ§åˆ¶å°è¾“å‡º

#### 4. ä¸»è®­ç»ƒå¾ªç¯
- `EvolutionaryTrainer` (ä¸»ç±»)
  - ç§ç¾¤åˆå§‹åŒ–
  - ä¸–ä»£å¾ªç¯
  - å¯¹æŠ—è®­ç»ƒ
  - é—ä¼ æ¼”åŒ–
  - æ£€æŸ¥ç‚¹ä¿å­˜

#### 5. å‘½ä»¤è¡Œæ¥å£
- `parse_arguments()` (å‡½æ•°)
- `main()` (å‡½æ•°)

### ä»£ç é‡ä¼°ç®—
çº¦ 690 è¡Œï¼ˆåŒ…å«æ³¨é‡Šå’Œæµ‹è¯•ï¼‰

---

## ä¸‰ã€å®ç°é¡ºåºå»ºè®®

### é˜¶æ®µ1: adversarial_trainer.pyï¼ˆ2-3å¤©ï¼‰

**Day 1: é…å¯¹ç­–ç•¥å’Œæ•°æ®ç»“æ„**
1. å®ç° `GameResult` æ•°æ®ç±»
2. å®ç° `MatchupStrategy` æŠ½è±¡åŸºç±»
3. å®ç° `RoundRobinStrategy`
4. å®ç° `TournamentStrategy`
5. å®ç° `AdaptiveMatchupStrategy`
6. å•å…ƒæµ‹è¯•é…å¯¹ç­–ç•¥

**Day 2: å¯¹æˆ˜æ‰§è¡Œå’Œå¹¶è¡ŒåŒ–**
1. å®ç° `run_single_game()` å‡½æ•°
2. å®ç° `ParallelGameExecutor` ç±»
3. æµ‹è¯•å•åœºæ¸¸æˆæ‰§è¡Œ
4. æµ‹è¯•å¹¶è¡Œæ‰§è¡Œ

**Day 3: é€‚åº”åº¦æ›´æ–°å’Œé›†æˆ**
1. å®ç° `update_fitness_from_results()` å‡½æ•°
2. å®ç° `AdversarialTrainer` ä¸»ç±»
3. é›†æˆæµ‹è¯•
4. æ€§èƒ½ä¼˜åŒ–

### é˜¶æ®µ2: train.pyï¼ˆ2-3å¤©ï¼‰

**Day 1: é…ç½®å’Œæ£€æŸ¥ç‚¹**
1. å®ç° `TrainingConfig` æ•°æ®ç±»
2. å®ç°é…ç½®åŠ è½½/ä¿å­˜å‡½æ•°
3. å®ç° `CheckpointManager` ç±»
4. æµ‹è¯•æ£€æŸ¥ç‚¹ä¿å­˜/åŠ è½½

**Day 2: æ—¥å¿—å’Œä¸»å¾ªç¯**
1. å®ç° `TrainingLogger` ç±»
2. å®ç° `EvolutionaryTrainer` ç±»
3. æµ‹è¯•è®­ç»ƒå¾ªç¯

**Day 3: å‘½ä»¤è¡Œæ¥å£å’Œé›†æˆ**
1. å®ç°å‘½ä»¤è¡Œå‚æ•°è§£æ
2. å®ç° `main()` å‡½æ•°
3. å®Œæ•´é›†æˆæµ‹è¯•
4. æ–‡æ¡£å’Œç¤ºä¾‹

---

## å››ã€å…³é”®ä¾èµ–å…³ç³»

```
train.py
    â†“
adversarial_trainer.py
    â†“
game_interface.py (âœ“ å·²å®Œæˆ)
    â†“
â”œâ”€â”€ sim_env.py (âœ“ å·²å®Œæˆ)
â”œâ”€â”€ reward_system.py (âœ“ å·²å®Œæˆ)
â”œâ”€â”€ transformer_model.py (âœ“ å·²å®Œæˆ)
â”œâ”€â”€ population.py (âœ“ å·²å®Œæˆ)
â””â”€â”€ genetic_ops.py (âœ“ å·²å®Œæˆ)
```

**æ‰€æœ‰åº•å±‚ä¾èµ–å·²å®Œæˆï¼Œå¯ä»¥å¼€å§‹å®ç°ï¼**

---

## äº”ã€æµ‹è¯•ç­–ç•¥

### 5.1 å•å…ƒæµ‹è¯•
- é…å¯¹ç­–ç•¥æµ‹è¯•
- æ£€æŸ¥ç‚¹ç®¡ç†æµ‹è¯•
- æ—¥å¿—ç³»ç»Ÿæµ‹è¯•

### 5.2 é›†æˆæµ‹è¯•
- å•åœºæ¸¸æˆæµ‹è¯•
- å¹¶è¡Œæ‰§è¡Œæµ‹è¯•
- å®Œæ•´è®­ç»ƒæµç¨‹æµ‹è¯•ï¼ˆå°è§„æ¨¡ï¼‰

### 5.3 æ€§èƒ½æµ‹è¯•
- å¹¶è¡Œåº¦æµ‹è¯•
- å†…å­˜ä½¿ç”¨æµ‹è¯•
- è®­ç»ƒé€Ÿåº¦æµ‹è¯•

---

## å…­ã€å¿«é€Ÿå¯åŠ¨æŒ‡å—

### 6.1 å®ç°åçš„ä½¿ç”¨æ–¹å¼

```bash
# å¿«é€Ÿæµ‹è¯•ï¼ˆéªŒè¯å®ç°ï¼‰
python train.py --quick-test

# ä½¿ç”¨é»˜è®¤é…ç½®è®­ç»ƒ
python train.py

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
python train.py --config configs/my_config.json

# æ¢å¤è®­ç»ƒ
python train.py --resume checkpoints/exp_001/checkpoint_gen_25.pth

# è‡ªå®šä¹‰å‚æ•°
python train.py --population-size 16 --num-generations 100 --num-workers 8
```

### 6.2 é¢„æœŸè¾“å‡º

```
============================================================
å¼€å§‹è¿›åŒ–è®­ç»ƒ
============================================================
ç§ç¾¤å·²åˆ›å»º: 8 ä¸ªä½“

============================================================
ä¸–ä»£ 0/50
æ¸©åº¦: 1.0000
============================================================
ä¸–ä»£ 0: åˆ›å»º 28 åœºå¯¹æˆ˜
å¼€å§‹æ‰§è¡Œ 28 åœºå¯¹æˆ˜ (å¹¶è¡Œåº¦: 4)
è¿›åº¦: 28/28 (100.0%)
[Gen   0] T=1.000 | Games= 28 | Fitness: 120.45 /  85.32 /  45.20 | ...
âœ“ æ£€æŸ¥ç‚¹å·²ä¿å­˜: checkpoints/ctf_evolution/best_gen_0.pth
```

---

## ä¸ƒã€æ€§èƒ½é¢„ä¼°

### 7.1 è®­ç»ƒæ—¶é—´
- **å•åœºæ¸¸æˆ**: ~15ç§’
- **å•ä¸–ä»£**: ~1.75åˆ†é’Ÿï¼ˆ8ä¸ªä½“ï¼Œ28åœºå¯¹æˆ˜ï¼Œ4å¹¶è¡Œï¼‰
- **å®Œæ•´è®­ç»ƒ**: ~88åˆ†é’Ÿï¼ˆ50ä¸–ä»£ï¼‰
- **ä¼˜åŒ–å**: ~30-40åˆ†é’Ÿ

### 7.2 èµ„æºéœ€æ±‚
- **CPU**: 4-8æ ¸å¿ƒæ¨è
- **å†…å­˜**: 8GBæ¨è
- **å­˜å‚¨**: ~500MBï¼ˆæ£€æŸ¥ç‚¹+æ—¥å¿—ï¼‰

---

## å…«ã€æ½œåœ¨é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

### 8.1 å¹¶è¡ŒåŒ–é—®é¢˜
**é—®é¢˜**: PyTorchæ¨¡å‹åœ¨å¤šè¿›ç¨‹é—´ä¼ é€’å¯èƒ½å‡ºé”™
**è§£å†³**: ä½¿ç”¨ `torch.multiprocessing` å’Œ `spawn` æ¨¡å¼

### 8.2 å†…å­˜æ³„æ¼
**é—®é¢˜**: é•¿æ—¶é—´è®­ç»ƒå¯èƒ½å¯¼è‡´å†…å­˜æ³„æ¼
**è§£å†³**: æ¯ä¸–ä»£åè°ƒç”¨ `gc.collect()`

### 8.3 è®­ç»ƒä¸­æ–­
**é—®é¢˜**: è®­ç»ƒè¢«æ„å¤–ä¸­æ–­
**è§£å†³**: å®ç°å¼‚å¸¸å¤„ç†å’Œç´§æ€¥æ£€æŸ¥ç‚¹ä¿å­˜

---

## ä¹ã€åç»­æ‰©å±•æ–¹å‘

1. **å¯è§†åŒ–ç³»ç»Ÿ**
   - è®­ç»ƒæ›²çº¿ç»˜åˆ¶
   - å¯¹æˆ˜å›æ”¾å¯è§†åŒ–
   - å®æ—¶ç›‘æ§é¢æ¿

2. **è¶…å‚æ•°ä¼˜åŒ–**
   - ä½¿ç”¨ Optuna è‡ªåŠ¨æœç´¢
   - ç½‘æ ¼æœç´¢
   - è´å¶æ–¯ä¼˜åŒ–

3. **åˆ†å¸ƒå¼è®­ç»ƒ**
   - ä½¿ç”¨ Ray å¤šæœºè®­ç»ƒ
   - GPU åŠ é€Ÿæ¨ç†
   - äº‘ç«¯è®­ç»ƒæ”¯æŒ

4. **å¯¹æˆ˜åˆ†æ**
   - ç­–ç•¥å¤šæ ·æ€§åˆ†æ
   - å¯¹æˆ˜é£æ ¼èšç±»
   - å¼±ç‚¹è¯†åˆ«

---

## åã€å®ç°æ£€æŸ¥æ¸…å•

### adversarial_trainer.py
- [ ] MatchupStrategy åŠå­ç±»
- [ ] GameResult æ•°æ®ç±»
- [ ] run_single_game å‡½æ•°
- [ ] ParallelGameExecutor ç±»
- [ ] update_fitness_from_results å‡½æ•°
- [ ] AdversarialTrainer ä¸»ç±»
- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•

### train.py
- [ ] TrainingConfig æ•°æ®ç±»
- [ ] é…ç½®åŠ è½½/ä¿å­˜å‡½æ•°
- [ ] CheckpointManager ç±»
- [ ] TrainingLogger ç±»
- [ ] EvolutionaryTrainer ä¸»ç±»
- [ ] å‘½ä»¤è¡Œæ¥å£
- [ ] å•å…ƒæµ‹è¯•
- [ ] å®Œæ•´è®­ç»ƒæµ‹è¯•

---

**åˆ›å»ºæ—¥æœŸ**: 2025-12-28
**çŠ¶æ€**: ğŸ“‹ è®¾è®¡å®Œæˆï¼Œå¾…å®ç°
**é¢„è®¡å®Œæˆæ—¶é—´**: 4-6å¤©
